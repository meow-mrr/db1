bil1
USE master;
GO

IF DB_ID('College') IS NOT NULL
    DROP DATABASE College;
GO

CREATE DATABASE College
ON PRIMARY
(
    NAME = College_Data,
    FILENAME = 'C:\SQLData\College_Data.mdf',
    SIZE = 5MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = College_Log,
    FILENAME = 'C:\SQLData\College_Log.ldf',
    SIZE = 2MB
);
GO

SELECT name FROM sys.databases WHERE name = 'College';
GO

USE College;
GO

CREATE TABLE Zachet
(
    StudNo INT PRIMARY KEY,
    FIO NVARCHAR(100) NULL,
    PM01 INT NULL,
    PM02 INT NULL
);
GO

CREATE PROCEDURE Stud
    @StudNo INT,
    @FIO NVARCHAR(100),
    @PM01 INT,
    @PM02 INT
AS
BEGIN
    INSERT INTO Zachet VALUES (@StudNo, @FIO, @PM01, @PM02);
END;
GO

EXEC Stud 1, N'Иванов Иван', 5, 5;
EXEC Stud 2, N'Петров Петр', 4, 5;
EXEC Stud 3, N'Сидоров Алексей', 5, 5;
EXEC Stud 4, N'Кузнецов Максим', 3, 4;
EXEC Stud 5, N'Орлов Денис', 5, 5;
GO

SELECT * FROM Zachet;
GO

CREATE VIEW View1
AS
SELECT * FROM Zachet
WHERE PM01 = 5 AND PM02 = 5;
GO

CREATE ROLE Teacher;
GO

CREATE LOGIN Prepod1 WITH PASSWORD = 'Pr123';
CREATE LOGIN Prepod2 WITH PASSWORD = 'Pr456';
GO

CREATE USER Prepod1 FOR LOGIN Prepod1;
CREATE USER Prepod2 FOR LOGIN Prepod2;
GO

EXEC sp_addrolemember 'Teacher', 'Prepod1';
GO

GRANT SELECT, UPDATE ON Zachet TO Teacher;
GRANT SELECT ON View1 TO Prepod2;
GRANT EXECUTE ON Stud TO Prepod2;
GO

EXEC sp_helprotect NULL, 'Zachet';
GO

EXEC sp_addumpdevice 'disk', 'Ust402-1', 'C:\SQLBackup\College.bak';
GO

BACKUP DATABASE College TO Ust402-1;
GO

EXEC sp_helpdb College;
GO

bil2
USE master;
GO

IF DB_ID('City') IS NOT NULL
    DROP DATABASE City;
GO

CREATE DATABASE City
ON PRIMARY
(
    NAME = City_Data,
    FILENAME = 'C:\SQLData\City_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = City_Log,
    FILENAME = 'C:\SQLData\City_Log.ldf',
    SIZE = 2MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
);
GO

SELECT name FROM sys.databases WHERE name = 'City';
GO

USE City;
GO

CREATE TABLE Adres
(
    member_no SMALLINT NOT NULL,
    street VARCHAR(20) NOT NULL,
    city VARCHAR(20) NOT NULL,
    state CHAR(2) NOT NULL,
    zip CHAR(10) NOT NULL,
    phone_no CHAR(13) NULL,
    expr_date DATE NOT NULL
);
GO

CREATE PROCEDURE Vvod
AS
BEGIN
    INSERT INTO Adres VALUES
    (1,'Nevsky','SPb','RU','190000','1234567890123','2026-01-01'),
    (2,'Lenina','Moscow','RU','101000',NULL,'2026-02-01'),
    (3,'Sadovaya','SPb','RU','190001','2222222222222','2026-03-01'),
    (4,'Tverskaya','Moscow','RU','101001','3333333333333','2026-04-01'),
    (5,'Liteiny','SPb','RU','190002',NULL,'2026-05-01');
END;
GO

EXEC Vvod;
GO

SELECT * FROM Adres;
GO

CREATE VIEW View_city
AS
SELECT * FROM Adres
WHERE city IN ('SPb','Moscow');
GO

CREATE ROLE Mayor;
GO

CREATE LOGIN Man WITH PASSWORD='Ar123';
CREATE LOGIN Woman WITH PASSWORD='Ar456';
GO

CREATE USER Man FOR LOGIN Man;
CREATE USER Woman FOR LOGIN Woman;
GO

EXEC sp_addrolemember 'Mayor','Woman';
GO

GRANT SELECT, UPDATE ON Adres TO Mayor;
GRANT SELECT ON View_city TO Man;
GRANT EXECUTE ON Vvod TO Man;
GRANT CREATE TABLE TO Woman;
GO

EXEC sp_helprotect NULL, 'Adres';
GO

EXEC sp_addumpdevice 'disk','Ust402-2','C:\SQLBackup\City.bak';
GO

BACKUP DATABASE City TO Ust402-2;
GO

EXEC sp_helpdb City;
GO

bil3
USE master;
GO

IF DB_ID('Telefon') IS NOT NULL
    DROP DATABASE Telefon;
GO

CREATE DATABASE Telefon
ON PRIMARY
(
    NAME = Telefon_Data,
    FILENAME = 'C:\SQLData\Telefon_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Telefon_Log,
    FILENAME = 'C:\SQLData\Telefon_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

SELECT name FROM sys.databases WHERE name='Telefon';
GO

USE Telefon;
GO

CREATE TABLE Abonent
(
    AbonentNo INT PRIMARY KEY,
    FIO NVARCHAR(100) NOT NULL,
    PayDate DATE NOT NULL,
    Tarif MONEY NOT NULL DEFAULT 600
);
GO

CREATE PROCEDURE Vvod_tel
AS
BEGIN
    INSERT INTO Abonent VALUES
    (1,N'Иванов Иван','2025-01-01',600),
    (2,N'Петров Петр','2025-01-02',700),
    (3,N'Сидоров Алексей','2025-01-03',600),
    (4,N'Орлов Денис','2025-01-04',600),
    (5,N'Кузнецов Максим','2025-01-05',800);
END;
GO

EXEC Vvod_tel;
GO

SELECT * FROM Abonent;
GO

CREATE VIEW View_tel
AS
SELECT COUNT(*) AS TotalAbonents FROM Abonent;
GO

CREATE ROLE Mobil;
GO

CREATE LOGIN Abonent1 WITH PASSWORD='Ab123';
CREATE LOGIN Abonent2 WITH PASSWORD='Ab456';
GO

CREATE USER Abonent1 FOR LOGIN Abonent1;
CREATE USER Abonent2 FOR LOGIN Abonent2;
GO

EXEC sp_addrolemember 'Mobil','Abonent1';
EXEC sp_addrolemember 'Mobil','Abonent2';
GO

GRANT SELECT, UPDATE ON Abonent TO Mobil;
GRANT SELECT ON View_tel TO Mobil;
GRANT EXECUTE ON Vvod_tel TO Mobil;
GRANT BACKUP DATABASE TO Abonent1;
GO

EXEC sp_helprotect NULL,'Abonent';
GO

EXEC sp_addumpdevice 'disk','Ust402-3','C:\SQLBackup\Telefon.bak';
GO

BACKUP DATABASE Telefon TO Ust402-3;
GO

EXEC sp_helpdb Telefon;
GO

bil4
USE master;
GO

IF DB_ID('Book') IS NOT NULL
    DROP DATABASE Book;
GO

CREATE DATABASE Book
ON PRIMARY
(
    NAME = Book_Data,
    FILENAME = 'C:\SQLData\Book_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Book_Log,
    FILENAME = 'C:\SQLData\Book_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

SELECT name FROM sys.databases WHERE name='Book';
GO

USE Book;
GO

SELECT *
INTO New_Authors
FROM Pubs.dbo.Authors;
GO

CREATE VIEW View_Book
AS
SELECT au_id, contract, au_fname, au_lname, city
FROM New_Authors;
GO

SELECT * FROM View_Book ORDER BY au_lname;
GO

INSERT INTO View_Book (au_id, contract, au_fname, au_lname, city)
VALUES ('99999',1,'Dgon','Yoko','Tokyo');
GO

UPDATE View_Book
SET au_lname='Yokomoto', au_fname='Akiko'
WHERE au_lname='Yoko' AND au_fname='Dgon';
GO

DELETE FROM View_Book WHERE au_id='99999';
GO

DROP VIEW View_Book;
GO

CREATE PROCEDURE Del_Book
AS
BEGIN
    DROP TABLE New_Authors;
END;
GO

EXEC Del_Book;
GO

CREATE ROLE Redactor;
GO

CREATE LOGIN Author1 WITH PASSWORD='Red100';
CREATE LOGIN Author2 WITH PASSWORD='Red200';
GO

CREATE USER Author1 FOR LOGIN Author1;
CREATE USER Author2 FOR LOGIN Author2;
GO

EXEC sp_addrolemember 'Redactor','Author1';
EXEC sp_addrolemember 'Redactor','Author2';
GO

GRANT SELECT, UPDATE ON New_Authors TO Redactor;
GRANT EXECUTE ON Del_Book TO Redactor;
GRANT BACKUP DATABASE TO Author1;
GRANT SELECT ON View_Book TO Author2;
GO

EXEC sp_addumpdevice 'disk','Ust402-4','C:\SQLBackup\Book.bak';
GO

BACKUP DATABASE Book TO Ust402-4;
GO

EXEC sp_helpdb Book;
GO

bil5
USE master;
GO

IF DB_ID('Mirror') IS NOT NULL
    DROP DATABASE Mirror;
GO

CREATE DATABASE Mirror
ON PRIMARY
(
    NAME = Mirror_Data,
    FILENAME = 'C:\SQLData\Mirror_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Mirror_Log,
    FILENAME = 'C:\SQLData\Mirror_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE Mirror;
GO

SELECT *
INTO Piter
FROM Pubs.dbo.Authors;
GO

CREATE PROCEDURE Del_Mirror
AS
BEGIN
    DELETE FROM Piter WHERE city <> 'Palo Alto';
END;
GO

CREATE PROCEDURE Upd_Mirror
AS
BEGIN
    UPDATE Piter SET city='SPb' WHERE city='Palo Alto';
END;
GO

EXEC Del_Mirror;
EXEC Upd_Mirror;
GO

CREATE VIEW View_Mirror
AS
SELECT COUNT(*) AS TotalSPb FROM Piter WHERE city='SPb';
GO

CREATE ROLE Mir;
GO

CREATE LOGIN Author1 WITH PASSWORD='Aut111';
CREATE LOGIN Author2 WITH PASSWORD='Aut222';
GO

CREATE USER Author1 FOR LOGIN Author1;
CREATE USER Author2 FOR LOGIN Author2;
GO

EXEC sp_addrolemember 'Mir','Author1';
EXEC sp_addrolemember 'Mir','Author2';
GO

GRANT EXECUTE ON Del_Mirror TO Mir;
GRANT EXECUTE ON Upd_Mirror TO Mir;
GRANT SELECT, UPDATE ON Piter TO Author1;
GO

EXEC sp_addumpdevice 'disk','Ust402-5','C:\SQLBackup\Mirror.bak';
GO

BACKUP DATABASE Mirror TO Ust402-5;
GO

EXEC sp_helpdb Mirror;
GO

bil6
USE master;
GO

IF DB_ID('Sphere') IS NOT NULL
    DROP DATABASE Sphere;
GO

CREATE DATABASE Sphere
ON PRIMARY
(
    NAME = Sphere_Data,
    FILENAME = 'C:\SQLData\Sphere_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Sphere_Log,
    FILENAME = 'C:\SQLData\Sphere_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE Sphere;
GO

CREATE TABLE Member
(
    member_no INT PRIMARY KEY,
    street NVARCHAR(50),
    city NVARCHAR(50),
    state NVARCHAR(10),
    phone_no NVARCHAR(20)
);
GO

CREATE TABLE Adult
(
    member_no INT PRIMARY KEY,
    lastname NVARCHAR(50),
    firstname NVARCHAR(50),
    middleinitial CHAR(1),
    photograph VARBINARY(MAX),
    CONSTRAINT FK_Adult FOREIGN KEY (member_no)
    REFERENCES Member(member_no)
);
GO

INSERT INTO Member VALUES
(1,'Nevsky','SPb','RU','111'),
(2,'Lenina','Moscow','RU','222'),
(3,'Sadovaya','SPb','RU','333');
GO

INSERT INTO Adult VALUES
(1,'Ivanov','Ivan','I',NULL),
(2,'Petrov','Petr','P',NULL),
(3,'Sidorov','Alex','A',NULL);
GO

CREATE PROCEDURE Upd_Sphere
    @member INT,
    @phone NVARCHAR(20)
AS
BEGIN
    UPDATE Member SET phone_no=@phone WHERE member_no=@member;
END;
GO

CREATE VIEW View_Sphere
AS
SELECT a.member_no, a.lastname, m.city, m.phone_no
FROM Adult a
JOIN Member m ON a.member_no=m.member_no;
GO

CREATE ROLE Sphere1;
GO

CREATE LOGIN Sph1 WITH PASSWORD='Sph333';
CREATE LOGIN Sph2 WITH PASSWORD='Sph444';
GO

CREATE USER Sph1 FOR LOGIN Sph1;
CREATE USER Sph2 FOR LOGIN Sph2;
GO

EXEC sp_addrolemember 'Sphere1','Sph1';
EXEC sp_addrolemember 'Sphere1','Sph2';
GO

GRANT EXECUTE ON Upd_Sphere TO Sphere1;
GRANT SELECT, UPDATE ON Member TO Sph1;
GO

EXEC sp_addumpdevice 'disk','Ust402-6','C:\SQLBackup\Sphere.bak';
GO

BACKUP DATABASE Sphere TO Ust402-6;
GO

EXEC sp_helpdb Sphere;
GO

bil7
USE master;
GO

IF DB_ID('Shop') IS NOT NULL
    DROP DATABASE Shop;
GO

CREATE DATABASE Shop
ON PRIMARY
(
    NAME = Shop_Data,
    FILENAME = 'C:\SQLData\Shop_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Shop_Log,
    FILENAME = 'C:\SQLData\Shop_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE Shop;
GO

SELECT *
INTO ORDDetails1
FROM Northwind.dbo.[Order Details];
GO

CREATE PROCEDURE Del_Shop
AS
BEGIN
    DECLARE @min MONEY, @max MONEY;
    SELECT @min = MIN(UnitPrice), @max = MAX(UnitPrice) FROM ORDDetails1;
    DELETE FROM ORDDetails1 WHERE UnitPrice IN (@min, @max);
END;
GO

CREATE PROCEDURE Upd_Shop
AS
BEGIN
    UPDATE ORDDetails1
    SET UnitPrice = UnitPrice + 100
    WHERE OrderID = 10265;
END;
GO

EXEC Del_Shop;
EXEC Upd_Shop;
GO

CREATE VIEW View_Shop
AS
SELECT * FROM ORDDetails1
WHERE OrderID IN (10250,10255);
GO

CREATE ROLE RoleShop;
GO

CREATE LOGIN Shop1 WITH PASSWORD='Shop234';
CREATE LOGIN Shop2 WITH PASSWORD='Shop235';
GO

CREATE USER Shop1 FOR LOGIN Shop1;
CREATE USER Shop2 FOR LOGIN Shop2;
GO

EXEC sp_addrolemember 'RoleShop','Shop1';
EXEC sp_addrolemember 'RoleShop','Shop2';
GO

GRANT EXECUTE ON Del_Shop TO RoleShop;
GRANT SELECT, UPDATE ON ORDDetails1 TO Shop2;
GO

EXEC sp_addumpdevice 'disk','Ust402-7','C:\SQLBackup\Shop.bak';
GO

BACKUP DATABASE Shop TO Ust402-7;
GO

EXEC sp_helpdb Shop;
GO

bil8
USE master;
GO

IF DB_ID('MyStud') IS NOT NULL
    DROP DATABASE MyStud;
GO

CREATE DATABASE MyStud
ON PRIMARY
(
    NAME = MyStud_Data,
    FILENAME = 'C:\SQLData\MyStud_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = MyStud_Log,
    FILENAME = 'C:\SQLData\MyStud_Log.ldf',
    SIZE = 2MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE MyStud;
GO

CREATE TABLE Anketa
(
    StudID INT PRIMARY KEY,
    LastName NVARCHAR(50) NOT NULL,
    FirstName NVARCHAR(50) NOT NULL,
    BirthYear INT NOT NULL,
    City NVARCHAR(50) NOT NULL DEFAULT N'СПб',
    Age INT NOT NULL
);
GO

CREATE PROCEDURE Vvod_Stud
AS
BEGIN
    INSERT INTO Anketa VALUES
    (1,N'Иванов',N'Иван',2001,N'СПб',24),
    (2,N'Петров',N'Петр',2000,N'Москва',25),
    (3,N'Сидоров',N'Алексей',2002,N'СПб',23),
    (4,N'Орлов',N'Денис',1999,N'Казань',26),
    (5,N'ТВОЯФАМИЛИЯ',N'ТВОЕИМЯ',2001,N'СПб',24);
END;
GO

EXEC Vvod_Stud;
GO

SELECT * FROM Anketa;
GO

CREATE VIEW View_Stud
AS
SELECT * FROM Anketa
WHERE BirthYear BETWEEN 2000 AND 2002;
GO

UPDATE Anketa
SET Age = Age * 2
WHERE LastName = N'ТВОЯФАМИЛИЯ';
GO

CREATE ROLE RoleStud;
GO

CREATE LOGIN Stud1 WITH PASSWORD='Stud777';
CREATE LOGIN Stud2 WITH PASSWORD='Stud666';
GO

CREATE USER Stud1 FOR LOGIN Stud1;
CREATE USER Stud2 FOR LOGIN Stud2;
GO

EXEC sp_addrolemember 'RoleStud','Stud1';
EXEC sp_addrolemember 'RoleStud','Stud2';
GO

GRANT SELECT, DELETE, UPDATE ON Anketa TO RoleStud;
GRANT SELECT ON View_Stud TO Stud2;
GRANT EXECUTE ON Vvod_Stud TO Stud2;
GRANT BACKUP DATABASE TO Stud1;
GO

EXEC sp_addumpdevice 'disk','Ust402-8','C:\SQLBackup\MyStud.bak';
GO

BACKUP DATABASE MyStud TO Ust402-8;
GO

EXEC sp_helpdb MyStud;
GO

bil9
USE master;
GO

IF DB_ID('MirBD') IS NOT NULL
    DROP DATABASE MirBD;
GO

CREATE DATABASE MirBD
ON PRIMARY
(
    NAME = MirBD_Data,
    FILENAME = 'C:\SQLData\MirBD_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = MirBD_Log,
    FILENAME = 'C:\SQLData\MirBD_Log.ldf',
    SIZE = 2MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE MirBD;
GO

CREATE TABLE Pristable
(
    integer INT NOT NULL,
    name CHAR(20) NOT NULL
);
GO

CREATE PROCEDURE Vvod_Mir
AS
BEGIN
    INSERT INTO Pristable VALUES
    (1,'anaconda'),
    (2,'bar harbor'),
    (3,'cape cod'),
    (4,'dubrovnik');
END;
GO

EXEC Vvod_Mir;
GO

ALTER TABLE Pristable ADD city NVARCHAR(50);
GO

UPDATE Pristable SET city='Paris' WHERE integer IN (3,4);
GO

CREATE VIEW View_Mir
AS
SELECT * FROM Pristable WHERE integer IN (2,3,4);
GO

CREATE PROCEDURE Del_Mir
AS
BEGIN
    DELETE FROM Pristable WHERE integer IN (2,4);
END;
GO

EXEC Del_Mir;
GO

CREATE ROLE RoleMir;
GO

CREATE LOGIN Mir1 WITH PASSWORD='Mir888';
CREATE LOGIN Mir2 WITH PASSWORD='Mir555';
GO

CREATE USER Mir1 FOR LOGIN Mir1;
CREATE USER Mir2 FOR LOGIN Mir2;
GO

EXEC sp_addrolemember 'RoleMir','Mir1';
GO

GRANT SELECT, DELETE, UPDATE ON Pristable TO RoleMir;
GRANT SELECT ON View_Mir TO Mir2;
GRANT EXECUTE ON Vvod_Mir TO Mir2;
GRANT BACKUP DATABASE TO Mir1;
GO

EXEC sp_addumpdevice 'disk','Ust402-9','C:\SQLBackup\MirBD.bak';
GO

BACKUP DATABASE MirBD TO Ust402-9;
GO

EXEC sp_helpdb MirBD;
GO

bil10
USE master;
GO

IF DB_ID('Prime402-1r') IS NOT NULL
    DROP DATABASE [Prime402-1r];
GO

CREATE DATABASE [Prime402-1r]
ON PRIMARY
(
    NAME = Prime_Data,
    FILENAME = 'C:\SQLData\Prime_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Prime_Log,
    FILENAME = 'C:\SQLData\Prime_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE [Prime402-1r];
GO

CREATE TABLE PRIMER
(
    Cod INT NOT NULL PRIMARY KEY,
    FirstName VARCHAR(30) NOT NULL,
    LastName VARCHAR(30) NOT NULL,
    YearBorn INT NOT NULL
);
GO

CREATE PROCEDURE Vvod_PR
AS
BEGIN
    INSERT INTO PRIMER VALUES
    (1,'Ivan','Ivanov',2000),
    (2,'Petr','Petrov',1999),
    (3,'Alex','Sidorov',2001),
    (4,'Max','Orlov',2002),
    (5,'Denis','Kuznetsov',1998);
END;
GO

EXEC Vvod_PR;
GO

SELECT * FROM PRIMER;
GO

CREATE PROCEDURE Upd_PR
    @OldLast VARCHAR(30),
    @NewLast VARCHAR(30)
AS
BEGIN
    UPDATE PRIMER SET LastName=@NewLast WHERE LastName=@OldLast;
END;
GO

EXEC Upd_PR 'Petrov','Smirnov';
GO

CREATE VIEW View_PR
AS
SELECT * FROM PRIMER
WHERE YearBorn BETWEEN 1999 AND 2002;
GO

CREATE ROLE RolePR;
GO

CREATE LOGIN PR1 WITH PASSWORD='PR234';
CREATE LOGIN PR2 WITH PASSWORD='PR235';
GO

CREATE USER PR1 FOR LOGIN PR1;
CREATE USER PR2 FOR LOGIN PR2;
GO

EXEC sp_addrolemember 'RolePR','PR1';
EXEC sp_addrolemember 'RolePR','PR2';
GO

GRANT EXECUTE ON Vvod_PR TO RolePR;
GRANT EXECUTE ON Upd_PR TO RolePR;
GRANT SELECT, UPDATE ON PRIMER TO PR2;
GO

EXEC sp_addumpdevice 'disk','Ust402-10','C:\SQLBackup\Prime.bak';
GO

BACKUP DATABASE [Prime402-1r] TO Ust402-10;
GO

EXEC sp_helpdb [Prime402-1r];
GO

bil11
USE master;
GO

IF DB_ID('Univer') IS NOT NULL
    DROP DATABASE Univer;
GO

CREATE DATABASE Univer
ON PRIMARY
(
    NAME = Univer_Data,
    FILENAME = 'C:\SQLData\Univer_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Univer_Log,
    FILENAME = 'C:\SQLData\Univer_Log.ldf',
    SIZE = 2MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE Univer;
GO

CREATE TABLE Table1
(
    Kod INT PRIMARY KEY,
    LastName NVARCHAR(50),
    FirstName NVARCHAR(50),
    Passport CHAR(10) UNIQUE NULL
);
GO

CREATE TABLE Table2
(
    Kod INT PRIMARY KEY,
    Grupa INT NULL CHECK (Grupa BETWEEN 100 AND 999),
    Faculty NVARCHAR(50),
    Curator NVARCHAR(50),
    CONSTRAINT FK_Table FOREIGN KEY (Kod) REFERENCES Table1(Kod)
);
GO

CREATE PROCEDURE Vvod1
AS
BEGIN
    INSERT INTO Table1 VALUES
    (1,N'Иванов',N'Иван','1234567890'),
    (2,N'Петров',N'Петр',NULL),
    (3,N'Сидоров',N'Алексей','9876543210');
END;
GO

CREATE PROCEDURE Vvod2
AS
BEGIN
    INSERT INTO Table2 VALUES
    (1,101,N'ИТ',N'Смирнов'),
    (2,202,N'Экономика',N'Орлова'),
    (3,303,N'ИТ',N'Кузнецов');
END;
GO

EXEC Vvod1;
EXEC Vvod2;
GO

CREATE VIEW View1
AS
SELECT t1.*
FROM Table1 t1
JOIN Table2 t2 ON t1.Kod=t2.Kod
WHERE t2.Faculty=N'ИТ';
GO

CREATE PROCEDURE Del1
    @Kod INT
AS
BEGIN
    DELETE FROM Table2 WHERE Kod=@Kod;
    DELETE FROM Table1 WHERE Kod=@Kod;
END;
GO

EXEC Del1 2;
GO

CREATE ROLE RoleUn;
GO

CREATE LOGIN Un1 WITH PASSWORD='Un881';
CREATE LOGIN Un2 WITH PASSWORD='Un551';
GO

CREATE USER Un1 FOR LOGIN Un1;
CREATE USER Un2 FOR LOGIN Un2;
GO

EXEC sp_addrolemember 'RoleUn','Un1';
EXEC sp_addrolemember 'RoleUn','Un2';
GO

GRANT SELECT, DELETE, UPDATE ON Table1 TO RoleUn;
GRANT SELECT, DELETE, UPDATE ON Table2 TO RoleUn;
GRANT BACKUP DATABASE TO Un1;
GO

EXEC sp_addumpdevice 'disk','Ust402-11','C:\SQLBackup\Univer.bak';
GO

BACKUP DATABASE Univer TO Ust402-11;
GO

EXEC sp_helpdb Univer;
GO

bil12
USE master;
GO

IF DB_ID('Les') IS NOT NULL
    DROP DATABASE Les;
GO

CREATE DATABASE Les
ON PRIMARY
(
    NAME = Les_Data,
    FILENAME = 'C:\SQLData\Les_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Les_Log,
    FILENAME = 'C:\SQLData\Les_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE Les;
GO

CREATE TABLE Grib
(
    GribID INT PRIMARY KEY,
    Name NVARCHAR(50) NOT NULL,
    DateGet DATE NOT NULL,
    WeightKg DECIMAL(5,2) NOT NULL
);
GO

CREATE PROCEDURE Vvod_les
AS
BEGIN
    INSERT INTO Grib VALUES
    (1,N'Белый','2025-09-01',12.5),
    (2,N'Подберезовик','2025-09-02',8.3),
    (3,N'Лисичка','2025-09-03',5.2),
    (4,N'Белый','2025-09-04',9.1),
    (5,N'Подберезовик','2025-09-05',7.0);
END;
GO

EXEC Vvod_les;
GO

SELECT * FROM Grib;
GO

CREATE VIEW View_les
AS
SELECT Name, DateGet, WeightKg
FROM Grib
WHERE Name IN (N'Белый',N'Подберезовик');
GO

CREATE PROCEDURE Up_les
    @Name NVARCHAR(50),
    @Date DATE,
    @NewWeight DECIMAL(5,2)
AS
BEGIN
    UPDATE Grib
    SET WeightKg=@NewWeight
    WHERE Name=@Name AND DateGet=@Date;
END;
GO

CREATE ROLE Grib1;
GO

CREATE LOGIN Les1 WITH PASSWORD='Gr123';
CREATE LOGIN Les2 WITH PASSWORD='Gr456';
GO

CREATE USER Les1 FOR LOGIN Les1;
CREATE USER Les2 FOR LOGIN Les2;
GO

EXEC sp_addrolemember 'Grib1','Les1';
EXEC sp_addrolemember 'Grib1','Les2';
GO

GRANT SELECT, UPDATE, DELETE ON Grib TO Grib1;
GRANT SELECT ON View_les TO Les1;
GRANT EXECUTE ON Vvod_les TO Les1;
GRANT BACKUP DATABASE TO Les2;
GO

EXEC sp_addumpdevice 'disk','Ust402-12','C:\SQLBackup\Les.bak';
GO

BACKUP DATABASE Les TO Ust402-12;
GO

EXEC sp_helpdb Les;
GO

bil13
USE master;
GO

IF DB_ID('Primer402-2') IS NOT NULL
    DROP DATABASE [Primer402-2];
GO

CREATE DATABASE [Primer402-2]
ON PRIMARY
(
    NAME = Primer2_Data,
    FILENAME = 'C:\SQLData\Primer2_Data.mdf',
    SIZE = 4MB,
    MAXSIZE = 12MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Primer2_Log,
    FILENAME = 'C:\SQLData\Primer2_Log.ldf',
    SIZE = 2MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE [Primer402-2];
GO

SELECT *
INTO NewTitles
FROM Pubs.dbo.Titles;
GO

CREATE PROCEDURE Del_Primer
AS
BEGIN
    DELETE FROM NewTitles
    WHERE price > 100 AND price < 200;
END;
GO

CREATE PROCEDURE Upd_Primer
AS
BEGIN
    UPDATE NewTitles
    SET price = price + 50
    WHERE title_id IN ('PC8888','PC9999','TC777');
END;
GO

EXEC Del_Primer;
EXEC Upd_Primer;
GO

CREATE VIEW View_Primer
AS
SELECT title_id, title, price, ytd_sales
FROM NewTitles;
GO

CREATE ROLE Manager;
GO

CREATE LOGIN Prim1 WITH PASSWORD='Prim987';
CREATE LOGIN Prim2 WITH PASSWORD='Prim654';
GO

CREATE USER Prim1 FOR LOGIN Prim1;
CREATE USER Prim2 FOR LOGIN Prim2;
GO

EXEC sp_addrolemember 'Manager','Prim1';
EXEC sp_addrolemember 'Manager','Prim2';
GO

GRANT EXECUTE ON Del_Primer TO Manager;
GRANT EXECUTE ON Upd_Primer TO Manager;
GRANT SELECT, UPDATE ON NewTitles TO Prim1;
GO

EXEC sp_addumpdevice 'disk','Ust402-13','C:\SQLBackup\Primer402_2.bak';
GO

BACKUP DATABASE [Primer402-2] TO Ust402-13;
GO

EXEC sp_helpdb [Primer402-2];
GO

bil14
USE master;
GO

IF DB_ID('Primer402-3') IS NOT NULL
    DROP DATABASE [Primer402-3];
GO

CREATE DATABASE [Primer402-3]
ON PRIMARY
(
    NAME = Primer3_Data,
    FILENAME = 'C:\SQLData\Primer3_Data.mdf',
    SIZE = 5MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Primer3_Log,
    FILENAME = 'C:\SQLData\Primer3_Log.ldf',
    SIZE = 2MB,
    FILEGROWTH = 1MB
);
GO

USE [Primer402-3];
GO

CREATE TABLE Veteran
(
    VetID INT PRIMARY KEY,
    LastName NVARCHAR(50) NULL,
    FirstName NVARCHAR(50) NULL,
    CardNo NVARCHAR(20) NOT NULL UNIQUE,
    InvalidGroup INT NULL CHECK (InvalidGroup IN (1,2,3)),
    Age INT NULL
);
GO

CREATE PROCEDURE Vvod_Prim
AS
BEGIN
    INSERT INTO Veteran VALUES
    (1,N'Иванов',N'Иван','A001',1,90),
    (2,N'Петров',N'Петр','A002',NULL,NULL),
    (3,N'Сидоров',N'Алексей','A003',2,88),
    (4,N'Орлов',N'Денис','A004',NULL,NULL),
    (5,N'Кузнецов',N'Максим','A005',3,70);
END;
GO

EXEC Vvod_Prim;
GO

SELECT * FROM Veteran;
GO

CREATE VIEW View1
AS
SELECT * FROM Veteran
WHERE InvalidGroup IS NULL AND Age IS NULL;
GO

SELECT COUNT(*) AS CountOver85 FROM Veteran WHERE Age > 85;
GO

CREATE ROLE Manager;
GO

CREATE LOGIN Veter1 WITH PASSWORD='Vrn123';
CREATE LOGIN Veter2 WITH PASSWORD='Vrn456';
GO

CREATE USER Veter1 FOR LOGIN Veter1;
CREATE USER Veter2 FOR LOGIN Veter2;
GO

EXEC sp_addrolemember 'Manager','Veter1';
GO

GRANT SELECT, UPDATE ON Veteran TO Manager;
GRANT SELECT ON View1 TO Veter2;
GRANT EXECUTE ON Vvod_Prim TO Veter2;
GO

EXEC sp_addumpdevice 'disk','Ust402-14','C:\SQLBackup\Primer402_3.bak';
GO

BACKUP DATABASE [Primer402-3] TO Ust402-14;
GO

bil15
USE master;
GO

IF DB_ID('Sport') IS NOT NULL
    DROP DATABASE Sport;
GO

CREATE DATABASE Sport
ON PRIMARY
(
    NAME = Sport_Data,
    FILENAME = 'C:\SQLData\Sport_Data.mdf',
    SIZE = 5MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Sport_Log,
    FILENAME = 'C:\SQLData\Sport_Log.ldf',
    SIZE = 2MB,
    FILEGROWTH = 1MB
);
GO

USE Sport;
GO

CREATE TABLE Sportsmen
(
    SportID INT PRIMARY KEY,
    Passport NVARCHAR(20) NOT NULL UNIQUE,
    LastName NVARCHAR(50) NULL,
    FirstName NVARCHAR(50) NULL,
    BirthDate DATE NULL,
    Rank NVARCHAR(50) NULL,
    Age INT NULL
);
GO

CREATE PROCEDURE Vvod_Sport
AS
BEGIN
    INSERT INTO Sportsmen VALUES
    (1,'P001',N'Иванов',N'Иван','2001-06-01',N'Мастер спорта',24),
    (2,'P002',N'Петров',N'Петр','1998-05-01',N'Чемпион России',27),
    (3,'P003',N'Сидоров',N'Алексей','2002-07-10',N'Мастер спорта',23),
    (4,'P004',N'Орлов',N'Денис','1997-03-15',N'Чемпион России',28),
    (5,'P005',N'Кузнецов',N'Максим','2000-08-20',N'Кандидат',25);
END;
GO

EXEC Vvod_Sport;
GO

SELECT * FROM Sportsmen;
GO

CREATE VIEW View1
AS
SELECT * FROM Sportsmen
WHERE BirthDate > '2000-05-01'
AND Rank = N'Мастер спорта';
GO

SELECT COUNT(*) AS ChampionCount
FROM Sportsmen
WHERE Rank = N'Чемпион России';
GO

CREATE ROLE Trener;
GO

CREATE LOGIN Sportsmen1 WITH PASSWORD='Sport123';
CREATE LOGIN Sportsmen2 WITH PASSWORD='Sport456';
GO

CREATE USER Sportsmen1 FOR LOGIN Sportsmen1;
CREATE USER Sportsmen2 FOR LOGIN Sportsmen2;
GO

EXEC sp_addrolemember 'Trener','Sportsmen1';
GO

GRANT SELECT, UPDATE ON Sportsmen TO Trener;
GRANT SELECT ON View1 TO Sportsmen2;
GRANT EXECUTE ON Vvod_Sport TO Sportsmen2;
GO

EXEC sp_addumpdevice 'disk','Ust402-15','C:\SQLBackup\Sport.bak';
GO

BACKUP DATABASE Sport TO Ust402-15;
GO

bil16
USE master;
GO

IF DB_ID('Shoy_Maska') IS NOT NULL
    DROP DATABASE Shoy_Maska;
GO

CREATE DATABASE Shoy_Maska
ON PRIMARY
(
    NAME = Maska_Data,
    FILENAME = 'C:\SQLData\Maska_Data.mdf',
    SIZE = 4MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Maska_Log,
    FILENAME = 'C:\SQLData\Maska_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 2MB
);
GO

USE Shoy_Maska;
GO

CREATE TABLE Member
(
    MemberID INT PRIMARY KEY,
    LastName NVARCHAR(50) NOT NULL,
    FirstName NVARCHAR(50) NOT NULL,
    MaskName NVARCHAR(50) NOT NULL UNIQUE,
    ShowDate DATE NOT NULL,
    Points INT NOT NULL
);
GO

CREATE PROCEDURE Vvod_Maska
AS
BEGIN
    INSERT INTO Member VALUES
    (1,N'Иванов',N'Иван',N'Банан','2025-03-01',85),
    (2,N'Петров',N'Петр',N'Солнце','2025-03-01',90),
    (3,N'Сидоров',N'Алексей',N'Попугай','2025-03-02',78),
    (4,N'Орлов',N'Денис',N'Змея','2025-03-02',88),
    (5,N'Кузнецов',N'Максим',N'Тигр','2025-03-03',92);
END;
GO

EXEC Vvod_Maska;
GO

SELECT * FROM Member;
GO

CREATE VIEW View_Maska
AS
SELECT * FROM Member WHERE ShowDate = '2025-03-01';
GO

CREATE PROCEDURE Up_Maska
    @ID INT,
    @Points INT
AS
BEGIN
    UPDATE Member SET Points=@Points WHERE MemberID=@ID;
END;
GO

CREATE ROLE Maska;
GO

CREATE LOGIN Mas1 WITH PASSWORD='MS123';
CREATE LOGIN Mas2 WITH PASSWORD='MS456';
GO

CREATE USER Mas1 FOR LOGIN Mas1;
CREATE USER Mas2 FOR LOGIN Mas2;
GO

EXEC sp_addrolemember 'Maska','Mas1';
EXEC sp_addrolemember 'Maska','Mas2';
GO

GRANT SELECT, UPDATE, DELETE ON Member TO Maska;
GRANT SELECT ON View_Maska TO Mas1;
GRANT EXECUTE ON Vvod_Maska TO Mas1;
GRANT EXECUTE ON Up_Maska TO Mas2;
GRANT SELECT ON Member TO Mas2;
GO

EXEC sp_addumpdevice 'disk','Ust402-16','C:\SQLBackup\Shoy_Maska.bak';
GO

BACKUP DATABASE Shoy_Maska TO Ust402-16;
GO

EXEC sp_helpdb Shoy_Maska;
GO

bil17
USE master;
GO

IF DB_ID('Shoy_Golos') IS NOT NULL
    DROP DATABASE Shoy_Golos;
GO

CREATE DATABASE Shoy_Golos
ON PRIMARY
(
    NAME = Golos_Data,
    FILENAME = 'C:\SQLData\Golos_Data.mdf',
    SIZE = 4MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = Golos_Log,
    FILENAME = 'C:\SQLData\Golos_Log.ldf',
    SIZE = 1MB,
    MAXSIZE = 4MB,
    FILEGROWTH = 1MB
);
GO

USE Shoy_Golos;
GO

CREATE TABLE Teacher
(
    TeacherID INT PRIMARY KEY,
    NickName NVARCHAR(50) NOT NULL
);
GO

CREATE TABLE Member
(
    MemberID INT PRIMARY KEY,
    LastName NVARCHAR(50) NOT NULL,
    FirstName NVARCHAR(50) NOT NULL,
    City NVARCHAR(50) NOT NULL,
    Age INT NOT NULL,
    Song NVARCHAR(100) NOT NULL,
    TeacherID INT NOT NULL,
    CONSTRAINT FK_Golos FOREIGN KEY (TeacherID)
    REFERENCES Teacher(TeacherID)
);
GO

CREATE PROCEDURE Vvod_Teacher
AS
BEGIN
    INSERT INTO Teacher VALUES
    (1,N'Баста'),
    (2,N'Полина'),
    (3,N'Шнур');
END;
GO

CREATE PROCEDURE Vvod_Member
AS
BEGIN
    INSERT INTO Member VALUES
    (1,N'Иванов',N'Иван',N'СПб',12,N'Песня1',1),
    (2,N'Петров',N'Петр',N'СПб',14,N'Песня2',1),
    (3,N'Сидоров',N'Алексей',N'Москва',15,N'Песня3',2),
    (4,N'Орлов',N'Денис',N'СПб',10,N'Песня4',3),
    (5,N'Кузнецов',N'Максим',N'СПб',16,N'Песня5',2);
END;
GO

EXEC Vvod_Teacher;
EXEC Vvod_Member;
GO

SELECT * FROM Teacher;
SELECT * FROM Member;
GO

CREATE VIEW View_member1
AS
SELECT * FROM Member
WHERE Age BETWEEN 10 AND 15 AND City=N'СПб';
GO

CREATE VIEW View_member2
AS
SELECT m.*
FROM Member m
JOIN Teacher t ON m.TeacherID=t.TeacherID
WHERE t.NickName=N'Баста';
GO

CREATE PROCEDURE Up_Teacher
    @ID INT,
    @NewName NVARCHAR(50)
AS
BEGIN
    UPDATE Teacher SET NickName=@NewName WHERE TeacherID=@ID;
END;
GO

CREATE ROLE Golos;
GO

CREATE LOGIN Us1 WITH PASSWORD='Golos345';
CREATE LOGIN Us2 WITH PASSWORD='Golos678';
GO

CREATE USER Us1 FOR LOGIN Us1;
CREATE USER Us2 FOR LOGIN Us2;
GO

EXEC sp_addrolemember 'Golos','Us1';
EXEC sp_addrolemember 'Golos','Us2';
GO

GRANT SELECT ON View_member1 TO Golos;
GRANT SELECT ON View_member2 TO Golos;
GRANT EXECUTE ON Vvod_Member TO Us1;
GRANT EXECUTE ON Vvod_Member TO Us2;
GRANT EXECUTE ON Vvod_Teacher TO Us1;
GRANT EXECUTE ON Vvod_Teacher TO Us2;
GO

EXEC sp_addumpdevice 'disk','Ust402-17','C:\SQLBackup\Shoy_Golos.bak';
GO

BACKUP DATABASE Shoy_Golos TO Ust402-17;
GO

EXEC sp_helpdb Shoy_Golos;
GO

bil18
USE master;
GO

IF DB_ID('News') IS NOT NULL
    DROP DATABASE News;
GO

CREATE DATABASE News
ON PRIMARY
(
    NAME = News_Data,
    FILENAME = 'C:\SQLData\News_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 1MB
)
LOG ON
(
    NAME = News_Log,
    FILENAME = 'C:\SQLData\News_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 5MB,
    FILEGROWTH = 1MB
);
GO

USE News;
GO

CREATE TABLE Events
(
    EventID INT PRIMARY KEY,
    EventName NVARCHAR(100) NOT NULL,
    EventDate DATE NOT NULL,
    EventTime TIME NOT NULL,
    City NVARCHAR(50) NOT NULL,
    Author NVARCHAR(50) NOT NULL,
    Channel NVARCHAR(50) NOT NULL
);
GO

CREATE PROCEDURE Vvod_Events
AS
BEGIN
    INSERT INTO Events VALUES
    (1,N'Событие1','2025-02-01','10:00','Москва',N'Иванов','Первый'),
    (2,N'Событие2','2025-02-05','14:00','СПб',N'Петров','Россия'),
    (3,N'Событие3','2025-02-07','18:00','СПб',N'Сидоров','НТВ'),
    (4,N'Событие4','2025-02-08','20:00','Казань',N'Иванов','Россия'),
    (5,N'Событие5','2025-02-09','13:00','Москва',N'Орлов','Первый');
END;
GO

EXEC Vvod_Events;
GO

SELECT * FROM Events;
GO

CREATE PROCEDURE Del_Ev
    @Author NVARCHAR(50)
AS
BEGIN
    DELETE FROM Events WHERE Author=@Author;
END;
GO

EXEC Del_Ev N'Иванов';
GO

CREATE VIEW View_Events1
AS
SELECT * FROM Events
WHERE EventDate >= DATEADD(DAY,-7,GETDATE())
AND Channel='Россия';
GO

CREATE VIEW View_Events2
AS
SELECT * FROM Events
WHERE EventTime > '12:00';
GO

CREATE ROLE RoleEvents;
GO

CREATE LOGIN Avtor1 WITH PASSWORD='Ev135';
CREATE LOGIN Avtor2 WITH PASSWORD='Ev246';
GO

CREATE USER Avtor1 FOR LOGIN Avtor1;
CREATE USER Avtor2 FOR LOGIN Avtor2;
GO

EXEC sp_addrolemember 'RoleEvents','Avtor1';
EXEC sp_addrolemember 'RoleEvents','Avtor2';
GO

GRANT EXECUTE ON Del_Ev TO RoleEvents;
GRANT SELECT, UPDATE ON Events TO Avtor2;
GRANT EXECUTE ON Vvod_Events TO Avtor2;
GRANT SELECT ON View_Events1 TO Avtor1;
GRANT SELECT ON View_Events2 TO Avtor1;
GO

EXEC sp_addumpdevice 'disk','Ust402-18','C:\SQLBackup\News.bak';
GO

BACKUP DATABASE News TO Ust402-18;
GO

EXEC sp_helpdb News;
GO

bil19
USE master;
GO

IF DB_ID('Magazin') IS NOT NULL
    DROP DATABASE Magazin;
GO

CREATE DATABASE Magazin
ON PRIMARY
(
    NAME = Magazin_Data,
    FILENAME = 'C:\SQLData\Magazin_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Magazin_Log,
    FILENAME = 'C:\SQLData\Magazin_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE Magazin;
GO

CREATE TABLE Goods
(
    GoodsID INT PRIMARY KEY,
    Name NVARCHAR(50) NOT NULL,
    Price MONEY NOT NULL,
    Amount INT NOT NULL
);
GO

CREATE PROCEDURE Vvod_Goods
AS
BEGIN
    INSERT INTO Goods VALUES
    (1,N'Хлеб',50,100),
    (2,N'Молоко',80,60),
    (3,N'Сыр',450,20),
    (4,N'Масло',200,40),
    (5,N'Колбаса',600,15);
END;
GO

EXEC Vvod_Goods;
GO

SELECT * FROM Goods;
GO

CREATE VIEW View_Goods
AS
SELECT Name, Price
FROM Goods
WHERE Amount > 30;
GO

CREATE PROCEDURE Up_Goods
    @ID INT,
    @NewPrice MONEY
AS
BEGIN
    UPDATE Goods SET Price=@NewPrice WHERE GoodsID=@ID;
END;
GO

CREATE ROLE Seller;
GO

CREATE LOGIN Sel1 WITH PASSWORD='Sel123';
CREATE LOGIN Sel2 WITH PASSWORD='Sel456';
GO

CREATE USER Sel1 FOR LOGIN Sel1;
CREATE USER Sel2 FOR LOGIN Sel2;
GO

EXEC sp_addrolemember 'Seller','Sel1';
EXEC sp_addrolemember 'Seller','Sel2';
GO

GRANT SELECT, UPDATE ON Goods TO Seller;
GRANT SELECT ON View_Goods TO Sel1;
GRANT EXECUTE ON Vvod_Goods TO Sel1;
GRANT EXECUTE ON Up_Goods TO Sel2;
GO

EXEC sp_addumpdevice 'disk','Ust402-19','C:\SQLBackup\Magazin.bak';
GO

BACKUP DATABASE Magazin TO Ust402-19;
GO

EXEC sp_helpdb Magazin;
GO

bil20
USE master;
GO

IF DB_ID('Aeroport') IS NOT NULL
    DROP DATABASE Aeroport;
GO

CREATE DATABASE Aeroport
ON PRIMARY
(
    NAME = Aero_Data,
    FILENAME = 'C:\SQLData\Aero_Data.mdf',
    SIZE = 6MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Aero_Log,
    FILENAME = 'C:\SQLData\Aero_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 2MB
);
GO

USE Aeroport;
GO

CREATE TABLE Flight
(
    FlightID INT PRIMARY KEY,
    CityFrom NVARCHAR(50),
    CityTo NVARCHAR(50),
    Plane NVARCHAR(50),
    FlightDate DATE,
    Price MONEY
);
GO

CREATE PROCEDURE Vvod_Flight
AS
BEGIN
    INSERT INTO Flight VALUES
    (1,N'Москва',N'СПб',N'Boeing','2025-01-01',5000),
    (2,N'СПб',N'Москва',N'Airbus','2025-01-02',5200),
    (3,N'Москва',N'Казань',N'SuperJet','2025-01-03',4500),
    (4,N'Казань',N'Москва',N'Boeing','2025-01-04',4700),
    (5,N'СПб',N'Казань',N'Airbus','2025-01-05',4900);
END;
GO

EXEC Vvod_Flight;
GO

SELECT * FROM Flight;
GO

CREATE VIEW View_Flight
AS
SELECT * FROM Flight
WHERE CityFrom=N'Москва' AND Price < 5000;
GO

CREATE PROCEDURE Del_Flight
    @Plane NVARCHAR(50)
AS
BEGIN
    DELETE FROM Flight WHERE Plane=@Plane;
END;
GO

CREATE ROLE Dispatcher;
GO

CREATE LOGIN Disp1 WITH PASSWORD='Disp123';
CREATE LOGIN Disp2 WITH PASSWORD='Disp456';
GO

CREATE USER Disp1 FOR LOGIN Disp1;
CREATE USER Disp2 FOR LOGIN Disp2;
GO

EXEC sp_addrolemember 'Dispatcher','Disp1';
EXEC sp_addrolemember 'Dispatcher','Disp2';
GO

GRANT SELECT, UPDATE, DELETE ON Flight TO Dispatcher;
GRANT SELECT ON View_Flight TO Disp1;
GRANT EXECUTE ON Vvod_Flight TO Disp1;
GRANT EXECUTE ON Del_Flight TO Disp2;
GO

EXEC sp_addumpdevice 'disk','Ust402-20','C:\SQLBackup\Aeroport.bak';
GO

BACKUP DATABASE Aeroport TO Ust402-20;
GO

EXEC sp_helpdb Aeroport;
GO

bil21
USE master;
GO

IF DB_ID('Apteka') IS NOT NULL
    DROP DATABASE Apteka;
GO

CREATE DATABASE Apteka
ON PRIMARY
(
    NAME = Apt_Data,
    FILENAME = 'C:\SQLData\Apt_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 12MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Apt_Log,
    FILENAME = 'C:\SQLData\Apt_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE Apteka;
GO

CREATE TABLE Medicine
(
    MedID INT PRIMARY KEY,
    Name NVARCHAR(50),
    Producer NVARCHAR(50),
    Price MONEY,
    ExpDate DATE
);
GO

CREATE PROCEDURE Vvod_Med
AS
BEGIN
    INSERT INTO Medicine VALUES
    (1,N'Аспирин',N'Bayer',120,'2026-01-01'),
    (2,N'Парацетамол',N'Фарм',90,'2025-12-01'),
    (3,N'Анальгин',N'Фарм',70,'2024-11-01'),
    (4,N'Ибупрофен',N'Bayer',150,'2026-03-01'),
    (5,N'Нурофен',N'Reckitt',250,'2026-05-01');
END;
GO

EXEC Vvod_Med;
GO

SELECT * FROM Medicine;
GO

CREATE VIEW View_Med
AS
SELECT Name, Price
FROM Medicine
WHERE Producer=N'Bayer';
GO

CREATE PROCEDURE Up_Med
    @ID INT,
    @NewPrice MONEY
AS
BEGIN
    UPDATE Medicine SET Price=@NewPrice WHERE MedID=@ID;
END;
GO

CREATE ROLE Pharmacist;
GO

CREATE LOGIN Phar1 WITH PASSWORD='Phar123';
CREATE LOGIN Phar2 WITH PASSWORD='Phar456';
GO

CREATE USER Phar1 FOR LOGIN Phar1;
CREATE USER Phar2 FOR LOGIN Phar2;
GO

EXEC sp_addrolemember 'Pharmacist','Phar1';
EXEC sp_addrolemember 'Pharmacist','Phar2';
GO

GRANT SELECT, UPDATE ON Medicine TO Pharmacist;
GRANT SELECT ON View_Med TO Phar1;
GRANT EXECUTE ON Vvod_Med TO Phar1;
GRANT EXECUTE ON Up_Med TO Phar2;
GO

EXEC sp_addumpdevice 'disk','Ust402-21','C:\SQLBackup\Apteka.bak';
GO

BACKUP DATABASE Apteka TO Ust402-21;
GO

EXEC sp_helpdb Apteka;
GO

bil22
USE master;
GO

IF DB_ID('Library') IS NOT NULL
    DROP DATABASE Library;
GO

CREATE DATABASE Library
ON PRIMARY
(
    NAME = Lib_Data,
    FILENAME = 'C:\SQLData\Lib_Data.mdf',
    SIZE = 5MB,
    MAXSIZE = 12MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Lib_Log,
    FILENAME = 'C:\SQLData\Lib_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE Library;
GO

CREATE TABLE Books
(
    BookID INT PRIMARY KEY,
    Title NVARCHAR(100) NOT NULL,
    Author NVARCHAR(50) NOT NULL,
    YearPub INT NOT NULL,
    Price MONEY NOT NULL
);
GO

CREATE PROCEDURE Vvod_Books
AS
BEGIN
    INSERT INTO Books VALUES
    (1,N'Война и мир',N'Толстой',1869,500),
    (2,N'Преступление и наказание',N'Достоевский',1866,450),
    (3,N'Мастер и Маргарита',N'Булгаков',1967,600),
    (4,N'Отцы и дети',N'Тургенев',1862,400),
    (5,N'Ревизор',N'Гоголь',1836,350);
END;
GO

EXEC Vvod_Books;
GO

SELECT * FROM Books;
GO

CREATE VIEW View_Books
AS
SELECT Title, Author
FROM Books
WHERE YearPub < 1900;
GO

CREATE PROCEDURE Del_Book
    @Author NVARCHAR(50)
AS
BEGIN
    DELETE FROM Books WHERE Author=@Author;
END;
GO

CREATE ROLE Librarian;
GO

CREATE LOGIN Lib1 WITH PASSWORD='Lib123';
CREATE LOGIN Lib2 WITH PASSWORD='Lib456';
GO

CREATE USER Lib1 FOR LOGIN Lib1;
CREATE USER Lib2 FOR LOGIN Lib2;
GO

EXEC sp_addrolemember 'Librarian','Lib1';
EXEC sp_addrolemember 'Librarian','Lib2';
GO

GRANT SELECT, UPDATE, DELETE ON Books TO Librarian;
GRANT SELECT ON View_Books TO Lib1;
GRANT EXECUTE ON Vvod_Books TO Lib1;
GRANT EXECUTE ON Del_Book TO Lib2;
GO

EXEC sp_addumpdevice 'disk','Ust402-22','C:\SQLBackup\Library.bak';
GO

BACKUP DATABASE Library TO Ust402-22;
GO

EXEC sp_helpdb Library;
GO

bil23
USE master;
GO

IF DB_ID('Hotel') IS NOT NULL
    DROP DATABASE Hotel;
GO

CREATE DATABASE Hotel
ON PRIMARY
(
    NAME = Hotel_Data,
    FILENAME = 'C:\SQLData\Hotel_Data.mdf',
    SIZE = 6MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Hotel_Log,
    FILENAME = 'C:\SQLData\Hotel_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE Hotel;
GO

CREATE TABLE Rooms
(
    RoomID INT PRIMARY KEY,
    RoomType NVARCHAR(50),
    Price MONEY,
    IsFree BIT
);
GO

CREATE PROCEDURE Vvod_Rooms
AS
BEGIN
    INSERT INTO Rooms VALUES
    (101,N'Стандарт',3000,1),
    (102,N'Стандарт',3000,0),
    (201,N'Люкс',6000,1),
    (202,N'Люкс',6000,0),
    (301,N'Президентский',12000,1);
END;
GO

EXEC Vvod_Rooms;
GO

SELECT * FROM Rooms;
GO

CREATE VIEW View_Rooms
AS
SELECT * FROM Rooms
WHERE IsFree=1;
GO

CREATE PROCEDURE Up_Room
    @ID INT,
    @Free BIT
AS
BEGIN
    UPDATE Rooms SET IsFree=@Free WHERE RoomID=@ID;
END;
GO

CREATE ROLE AdminHotel;
GO

CREATE LOGIN Hot1 WITH PASSWORD='Hot123';
CREATE LOGIN Hot2 WITH PASSWORD='Hot456';
GO

CREATE USER Hot1 FOR LOGIN Hot1;
CREATE USER Hot2 FOR LOGIN Hot2;
GO

EXEC sp_addrolemember 'AdminHotel','Hot1';
EXEC sp_addrolemember 'AdminHotel','Hot2';
GO

GRANT SELECT, UPDATE ON Rooms TO AdminHotel;
GRANT SELECT ON View_Rooms TO Hot1;
GRANT EXECUTE ON Vvod_Rooms TO Hot1;
GRANT EXECUTE ON Up_Room TO Hot2;
GO

EXEC sp_addumpdevice 'disk','Ust402-23','C:\SQLBackup\Hotel.bak';
GO

BACKUP DATABASE Hotel TO Ust402-23;
GO

EXEC sp_helpdb Hotel;
GO

bil24
USE master;
GO

IF DB_ID('Cinema') IS NOT NULL
    DROP DATABASE Cinema;
GO

CREATE DATABASE Cinema
ON PRIMARY
(
    NAME = Cin_Data,
    FILENAME = 'C:\SQLData\Cin_Data.mdf',
    SIZE = 6MB,
    MAXSIZE = 15MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Cin_Log,
    FILENAME = 'C:\SQLData\Cin_Log.ldf',
    SIZE = 3MB,
    MAXSIZE = 8MB,
    FILEGROWTH = 2MB
);
GO

USE Cinema;
GO

CREATE TABLE Films
(
    FilmID INT PRIMARY KEY,
    Title NVARCHAR(100),
    Genre NVARCHAR(50),
    Duration INT,
    Price MONEY
);
GO

CREATE PROCEDURE Vvod_Films
AS
BEGIN
    INSERT INTO Films VALUES
    (1,N'Матрица',N'Фантастика',136,350),
    (2,N'Интерстеллар',N'Фантастика',169,400),
    (3,N'Начало',N'Триллер',148,380),
    (4,N'Титаник',N'Драма',195,300),
    (5,N'Гладиатор',N'Исторический',155,370);
END;
GO

EXEC Vvod_Films;
GO

SELECT * FROM Films;
GO

CREATE VIEW View_Films
AS
SELECT Title, Price
FROM Films
WHERE Genre=N'Фантастика';
GO

CREATE PROCEDURE Del_Film
    @Title NVARCHAR(100)
AS
BEGIN
    DELETE FROM Films WHERE Title=@Title;
END;
GO

CREATE ROLE CinemaAdmin;
GO

CREATE LOGIN Cin1 WITH PASSWORD='Cin123';
CREATE LOGIN Cin2 WITH PASSWORD='Cin456';
GO

CREATE USER Cin1 FOR LOGIN Cin1;
CREATE USER Cin2 FOR LOGIN Cin2;
GO

EXEC sp_addrolemember 'CinemaAdmin','Cin1';
EXEC sp_addrolemember 'CinemaAdmin','Cin2';
GO

GRANT SELECT, UPDATE, DELETE ON Films TO CinemaAdmin;
GRANT SELECT ON View_Films TO Cin1;
GRANT EXECUTE ON Vvod_Films TO Cin1;
GRANT EXECUTE ON Del_Film TO Cin2;
GO

EXEC sp_addumpdevice 'disk','Ust402-24','C:\SQLBackup\Cinema.bak';
GO

BACKUP DATABASE Cinema TO Ust402-24;
GO

EXEC sp_helpdb Cinema;
GO

bil25
USE master;
GO

IF DB_ID('Factory') IS NOT NULL
    DROP DATABASE Factory;
GO

CREATE DATABASE Factory
ON PRIMARY
(
    NAME = Fact_Data,
    FILENAME = 'C:\SQLData\Fact_Data.mdf',
    SIZE = 6MB,
    MAXSIZE = 20MB,
    FILEGROWTH = 2MB
)
LOG ON
(
    NAME = Fact_Log,
    FILENAME = 'C:\SQLData\Fact_Log.ldf',
    SIZE = 4MB,
    MAXSIZE = 10MB,
    FILEGROWTH = 2MB
);
GO

USE Factory;
GO

CREATE TABLE Workers
(
    WorkerID INT PRIMARY KEY,
    LastName NVARCHAR(50),
    FirstName NVARCHAR(50),
    Workshop NVARCHAR(50),
    Salary MONEY,
    Experience INT
);
GO

CREATE PROCEDURE Vvod_Workers
AS
BEGIN
    INSERT INTO Workers VALUES
    (1,N'Иванов',N'Иван',N'Сборка',60000,5),
    (2,N'Петров',N'Петр',N'Сборка',65000,7),
    (3,N'Сидоров',N'Алексей',N'Покраска',55000,4),
    (4,N'Орлов',N'Денис',N'Контроль',70000,8),
    (5,N'Кузнецов',N'Максим',N'Покраска',58000,6);
END;
GO

EXEC Vvod_Workers;
GO

SELECT * FROM Workers;
GO

CREATE VIEW View_Workers
AS
SELECT LastName, Salary
FROM Workers
WHERE Experience > 5;
GO

CREATE PROCEDURE Up_Salary
    @ID INT,
    @NewSalary MONEY
AS
BEGIN
    UPDATE Workers SET Salary=@NewSalary WHERE WorkerID=@ID;
END;
GO

CREATE ROLE ManagerFactory;
GO

CREATE LOGIN Fact1 WITH PASSWORD='Fact123';
CREATE LOGIN Fact2 WITH PASSWORD='Fact456';
GO

CREATE USER Fact1 FOR LOGIN Fact1;
CREATE USER Fact2 FOR LOGIN Fact2;
GO

EXEC sp_addrolemember 'ManagerFactory','Fact1';
EXEC sp_addrolemember 'ManagerFactory','Fact2';
GO

GRANT SELECT, UPDATE ON Workers TO ManagerFactory;
GRANT SELECT ON View_Workers TO Fact1;
GRANT EXECUTE ON Vvod_Workers TO Fact1;
GRANT EXECUTE ON Up_Salary TO Fact2;
GO

EXEC sp_addumpdevice 'disk','Ust402-25','C:\SQLBackup\Factory.bak';
GO

BACKUP DATABASE Factory TO Ust402-25;
GO

EXEC sp_helpdb Factory;
GO
